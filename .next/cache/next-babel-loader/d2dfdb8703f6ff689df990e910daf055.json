{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React from \"react\";\nimport { BoxStyle2, SelectBox3 as SelectBox, MobileItemDrop, Loading } from \"../../../../../common\";\nimport { ProtraitPhonesAndBigger, ProtraitPhones, LandScapePhones, LandScapePhonesAndBigger } from \"../../../../../../Responsive\";\nimport { Translate } from \"react-localize-redux\";\nimport { ReactComponent as ArsIcon1 } from \"./../../../../../../assets/icons/business-and-trade.svg\";\nimport { ReactComponent as EditIcon } from \"./../../../../../../assets/icons/edit-small.svg\";\nimport { ReactComponent as DeleteIcon } from \"./../../../../../../assets/icons/delete.svg\";\nimport { ReactComponent as AddBlueIcon } from \"./../../../../../../assets/icons/add-blue.svg\";\nimport { useEffect } from \"react\";\nimport { useState } from \"react\";\nimport { client_getAddresses, client_deleteAddress, client_changeDestination } from \"../../../../../../lib/api/client/clientOrder\";\nimport { SELECT_ADDRESS, VERIFY_PHONE } from \"./ShippingAddressConstant\";\nimport { getErrorMsg } from \"../../../../../../lib/helpers\";\nimport { useSelector } from \"react-redux\";\nimport { selectLang } from \"../../../../../../appConfigSlice\";\nimport { NEXT } from \"../../OrderConstants\";\nimport { toast } from \"react-toastify\";\nimport { getToastConfig } from \"../../../../../../lib/toast\";\nimport NoAddressesPage from \"../../../UserPanel/PanelPages/Addresses/AddressesLayouts/NoAddressesPage\";\nimport classnames from \"classnames\";\nimport { client_changeMobileNumber, client_setDefaultAddress } from \"../../../../../../lib/api/client/clientCommon\";\nimport { PhoneNumberFormat, PhoneNumberUtil } from \"google-libphonenumber\";\n\nvar AddressesList = function AddressesList(_ref) {\n  var handleSituation = _ref.handleSituation,\n      setData = _ref.setData,\n      handleOrderStep = _ref.handleOrderStep;\n\n  var _useState = useState(false),\n      addressLoading = _useState[0],\n      setAddressLoading = _useState[1];\n\n  var _useState2 = useState([]),\n      addressList = _useState2[0],\n      setAddressList = _useState2[1];\n\n  var _useState3 = useState(null),\n      selectedAddress = _useState3[0],\n      setSelectedAddress = _useState3[1];\n\n  var _useState4 = useState(false),\n      continueLoading = _useState4[0],\n      setContinueLoading = _useState4[1];\n\n  var _useState5 = useState(false),\n      verifyLoading = _useState5[0],\n      setVerifyLoading = _useState5[1];\n\n  var lang = useSelector(selectLang);\n  var PNF = PhoneNumberFormat;\n  var phoneUtil = PhoneNumberUtil.getInstance();\n\n  var getAddresses = function getAddresses() {\n    setAddressLoading(true);\n    setSelectedAddress(null);\n    client_getAddresses().then(function (response) {\n      if (response.status === 200) {\n        setAddressList(response.result);\n        setAddressLoading(false);\n      }\n    })[\"catch\"](function (err) {\n      console.log(err);\n    });\n  };\n\n  useEffect(function () {\n    getAddresses();\n    return function () {};\n  }, []);\n\n  var handleDelete = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(addressId) {\n      var con, del_resutl;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              con = confirm(getErrorMsg(lang, \"confirm-address-delete\"));\n\n              if (con) {\n                _context.next = 3;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 3:\n              setAddressLoading(true);\n              _context.next = 6;\n              return client_deleteAddress(addressId);\n\n            case 6:\n              del_resutl = _context.sent;\n\n              if (del_resutl.status === 200) {\n                client_getAddresses().then(function (response) {\n                  if (response.status === 200) {\n                    setAddressList(response.result);\n                    setAddressLoading(false);\n                  }\n                })[\"catch\"](function (err) {\n                  console.log(err);\n                });\n              }\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleDelete(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleEdit = function handleEdit(adr) {\n    setData({\n      addressId: adr.addressId,\n      address: adr.address,\n      firstname: adr.transfereeName,\n      lastname: adr.transfereeFamily,\n      postalCode: adr.postalCode,\n      mobileNumber: adr.transfereeMobile,\n      requestId: null,\n      lat: adr.locationX,\n      lng: adr.locationY,\n      isUpdate: true\n    }, function () {\n      handleSituation(SELECT_ADDRESS);\n    });\n  };\n\n  var handleAddNew = function handleAddNew() {\n    setData({\n      addressId: null,\n      address: null,\n      firstname: null,\n      lastname: null,\n      postalCode: null,\n      mobileNumber: null,\n      lat: null,\n      lng: null,\n      isUpdate: false\n    }, function () {\n      handleSituation(SELECT_ADDRESS);\n    });\n  };\n\n  var handleSelectAddress = function handleSelectAddress(selected) {\n    var id = selected[0] ? parseInt(selected[0].name) : null;\n    var verified = selected[0] ? selected[0].value : null;\n    setSelectedAddress({\n      id: id,\n      verified: verified\n    });\n  };\n\n  var handleContinueClick = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!continueLoading) {\n                _context2.next = 2;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 2:\n              if (!(!selectedAddress || selectedAddress.id === null)) {\n                _context2.next = 5;\n                break;\n              }\n\n              toast.error(getErrorMsg(lang, \"select-address\"), getToastConfig());\n              return _context2.abrupt(\"return\");\n\n            case 5:\n              if (selectedAddress.verified) {\n                _context2.next = 8;\n                break;\n              }\n\n              toast.error(getErrorMsg(lang, \"verify-mobile\"), getToastConfig());\n              return _context2.abrupt(\"return\");\n\n            case 8:\n              setContinueLoading(true);\n              _context2.prev = 9;\n              _context2.next = 12;\n              return client_changeDestination(selectedAddress.id);\n\n            case 12:\n              res = _context2.sent;\n\n              if (res.status === 200) {\n                handleOrderStep(NEXT);\n              }\n\n              _context2.next = 20;\n              break;\n\n            case 16:\n              _context2.prev = 16;\n              _context2.t0 = _context2[\"catch\"](9);\n              setContinueLoading(false);\n              toast.error(_context2.t0.response.data.message, getToastConfig());\n\n            case 20:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[9, 16]]);\n    }));\n\n    return function handleContinueClick() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleVerifyClick = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(item) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!verifyLoading) {\n                _context3.next = 2;\n                break;\n              }\n\n              return _context3.abrupt(\"return\");\n\n            case 2:\n              setVerifyLoading(true);\n              _context3.prev = 3;\n              _context3.next = 6;\n              return client_changeMobileNumber({\n                addressId: item.addressId,\n                mobileNumber: item.transfereeMobile.trim()\n              });\n\n            case 6:\n              res = _context3.sent;\n\n              if (res.status == \"200\") {\n                setData({\n                  iso: item.iso,\n                  phoneCode: item.phoneCode,\n                  mobileNumber: item.transfereeMobile.trim(),\n                  addressId: item.addressId,\n                  requestId: res.result.requestId\n                }, function () {\n                  handleSituation(VERIFY_PHONE);\n                });\n              }\n\n              _context3.next = 14;\n              break;\n\n            case 10:\n              _context3.prev = 10;\n              _context3.t0 = _context3[\"catch\"](3);\n              // this.setState({ verifyLoading: false });\n              toast.error(_context3.t0.response.data.message, getToastConfig());\n              setVerifyLoading(false);\n\n            case 14:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[3, 10]]);\n    }));\n\n    return function handleVerifyClick(_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var handleSetDefault = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(addressId) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return client_setDefaultAddress({\n                addressId: addressId\n              });\n\n            case 3:\n              res = _context4.sent;\n\n              if (res.status == \"200\") {\n                getAddresses();\n              }\n\n              _context4.next = 10;\n              break;\n\n            case 7:\n              _context4.prev = 7;\n              _context4.t0 = _context4[\"catch\"](0);\n              toast.error(_context4.t0.response.data.message, getToastConfig());\n\n            case 10:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 7]]);\n    }));\n\n    return function handleSetDefault(_x3) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(React.Fragment, null, __jsx(BoxStyle2, {\n    className: \"orderaddress\"\n  }, addressLoading ? __jsx(Loading, {\n    type: \"gray\",\n    width: \"40px\",\n    height: \"40px\",\n    styleSheet: {\n      margin: \"50px auto\"\n    }\n  }) : __jsx(\"section\", {\n    className: \"orderaddress__cnt\"\n  }, addressList.length === 0 && __jsx(NoAddressesPage, {\n    withoutBtn: true\n  }), __jsx(\"div\", {\n    className: \"mt-2 mb-2\"\n  }, addressList.length > 0 ? __jsx(SelectBox, {\n    className: \"returns-add-single__select-box--addresses\",\n    onChange: handleSelectAddress\n  }, addressList.map(function (adr) {\n    return __jsx(SelectBox.SelectItem, {\n      justCircleClick: true,\n      name: adr.addressId,\n      value: adr.mobileVerifed\n    }, __jsx(\"div\", {\n      className: \"addresses__item-cnt no-gutters justify-content-between flex-wrap returns-add-single__addresses\"\n    }, __jsx(LandScapePhones, null, __jsx(MobileItemDrop, null, __jsx(\"a\", {\n      href: \"\",\n      className: \"addresses__right-item addresses__right-item--iconi\",\n      onClick: function onClick(e) {\n        e.preventDefault();\n        handleDelete(adr.addressId);\n      }\n    }, __jsx(DeleteIcon, {\n      className: \"addresses__right-item-icon\"\n    }), __jsx(Translate, {\n      id: \"common.delete-address\"\n    })), __jsx(\"a\", {\n      href: \"\",\n      className: \"addresses__right-item addresses__right-item--iconi\",\n      onClick: function onClick(e) {\n        e.preventDefault();\n        handleEdit(adr);\n      }\n    }, __jsx(EditIcon, {\n      className: \"addresses__right-item-icon\"\n    }), __jsx(Translate, {\n      id: \"common.edit\"\n    })))), __jsx(\"div\", {\n      className: \"col-12 col-md-5 addresses__row-item\"\n    }, __jsx(\"span\", {\n      className: \"addresses__icon-cnt\"\n    }, __jsx(ArsIcon1, {\n      className: \"addresses__left-icon\"\n    })), __jsx(\"p\", {\n      className: \"addresses__ars-text\"\n    }, adr.address)), __jsx(\"div\", {\n      className: \"col-auto addresses__row-item\"\n    }, __jsx(\"span\", {\n      className: \"addresses__ars-head\"\n    }, __jsx(Translate, {\n      id: \"common.name\"\n    })), __jsx(\"span\", {\n      className: \"addresses__ars-value\"\n    }, adr.transfereeName + \" \" + adr.transfereeFamily)), __jsx(\"div\", {\n      className: \"col-auto  col-sm-auto addresses__row-item\"\n    }, __jsx(\"span\", {\n      className: \"addresses__ars-head\"\n    }, __jsx(Translate, {\n      id: \"common.phone\"\n    })), __jsx(\"span\", {\n      className: \"addresses__ars-value\"\n    }, phoneUtil.format(phoneUtil.parseAndKeepRawInput(adr.phoneCode + adr.transfereeMobile, adr.iso), PNF.INTERNATIONAL)), !adr.mobileVerifed && __jsx(\"span\", {\n      className: classnames(\"addresses__ars-alert\", \"d-block\", {\n        \"addresses__ars-alert--disable\": verifyLoading\n      }),\n      onClick: function onClick() {\n        handleVerifyClick(adr);\n      }\n    }, __jsx(\"span\", {\n      className: \"addresses__alert-icon\"\n    }, \"!\"), __jsx(Translate, {\n      id: \"common.not-verified\"\n    }))), __jsx(LandScapePhonesAndBigger, null, __jsx(\"div\", {\n      className: \"col-12 col-md-auto addresses__row-item\"\n    }, adr.isDefualt ? __jsx(\"a\", {\n      onClick: function onClick(e) {\n        e.preventDefault();\n      },\n      href: \"\",\n      className: \"addresses__right-item addresses__right-item--gray-btn\"\n    }, __jsx(Translate, {\n      id: \"common.primary-address\"\n    })) : __jsx(\"a\", {\n      href: \"\",\n      onClick: function onClick(e) {\n        e.preventDefault();\n        handleSetDefault(adr.addressId);\n      },\n      className: \"addresses__right-item addresses__right-item--primary-btn\"\n    }, __jsx(Translate, {\n      id: \"addresses.default\"\n    })), __jsx(\"a\", {\n      href: \"\",\n      className: \"addresses__right-item addresses__right-item--iconi\",\n      onClick: function onClick(e) {\n        e.preventDefault();\n        handleDelete(adr.addressId);\n      }\n    }, __jsx(DeleteIcon, {\n      className: \"addresses__right-item-icon\"\n    }), __jsx(Translate, {\n      id: \"common.delete-address\"\n    })), __jsx(\"a\", {\n      href: \"\",\n      className: \"addresses__right-item addresses__right-item--iconi\",\n      onClick: function onClick(e) {\n        e.preventDefault();\n        handleEdit(adr);\n      }\n    }, __jsx(EditIcon, {\n      className: \"addresses__right-item-icon\"\n    }), __jsx(Translate, {\n      id: \"common.edit\"\n    }))))));\n  })) : null))), __jsx(\"section\", {\n    className: \"order-re__btn-cnt d-flex justify-content-end mt-4 mb-4 mr-xl-0 mr-3\"\n  }, __jsx(ProtraitPhonesAndBigger, null, __jsx(\"button\", {\n    className: \"primary-btn\",\n    onClick: handleAddNew\n  }, __jsx(Translate, {\n    id: \"shipping.add-new-address\"\n  })), __jsx(\"button\", {\n    // onClick={this.handleContinueClick}\n    className: \"primary-btn ml-4  rtl-ml-0 rtl-mr-4\",\n    onClick: handleContinueClick\n  }, continueLoading ? __jsx(Loading, {\n    type: \"white\",\n    width: \"20px\",\n    height: \"19px\",\n    styleSheet: {\n      display: \"inline\"\n    }\n  }) : __jsx(Translate, {\n    id: \"common.continue\"\n  }))), __jsx(ProtraitPhones, {\n    className: \"w-100\"\n  }, __jsx(\"button\", {\n    className: \"orderaddress__full-with-btn\",\n    onClick: handleAddNew\n  }, __jsx(AddBlueIcon, {\n    className: \"orderaddress__full-with-btn-icon\"\n  }), __jsx(Translate, {\n    id: \"shipping.add-new-address\"\n  })), __jsx(\"div\", {\n    className: \"checkout-fix justify-content-center\"\n  }, __jsx(\"button\", {\n    //   onClick={this.handleContinueClick}\n    className: \"primary-btn returns__add-btn\",\n    onClick: handleContinueClick\n  }, continueLoading ? __jsx(Loading, {\n    type: \"white\",\n    width: \"20px\",\n    height: \"19px\",\n    styleSheet: {\n      display: \"inline\"\n    }\n  }) : __jsx(Translate, {\n    id: \"common.continue\"\n  }))))));\n};\n\nexport default AddressesList;","map":null,"metadata":{},"sourceType":"module"}
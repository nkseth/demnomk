{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\"; // import \"./GoodDetail.scss\";\n// import \"./GoodDetail-rtl.scss\";\n\nimport { connect } from \"react-redux\";\nimport { BoxStyle1, BoxStyle2, BreadCrump } from \"../../../common\";\nimport { Translate } from \"react-localize-redux\";\nimport Cookies from \"js-cookie\";\nimport { ItemDetail, DeliveryPanel, GoodDetailAside, GoodDetailTabs } from \"./GoodDetailLayouts\";\nimport { CSSTransition } from \"react-transition-group\";\nimport { selectLang, selectCurr, selectLogin, PREVLINK_CHANGE } from \"../../../../appConfigSlice\";\nimport { generatetGoodsVarietyExistencePossibilityAndPrintStructure } from \"./GoodDetailAlgo\";\nimport { GoodDetailContext } from \"./GoodDetailContext\";\nimport { client_addToCart, client_likeGood } from \"../../../../lib/api/client/clientCart\";\nimport { setCartCookie } from \"../../../../lib/helpers\";\nimport axiosClient from \"../../../../lib/api/axios\";\nimport { withRouter } from \"next/router\";\nimport { client_viewGood } from \"../../../../lib/api/client/clientCommon\";\nimport { selectWishCount, addWishCount } from \"../CartAndWishlist/cartAndWishlistSlice\";\nimport GoodsSlider from \"../../GoodsSlider\";\nimport { DesktopsAndBigger } from \"../../../../Responsive\";\n\nvar GoodDetail = /*#__PURE__*/function (_React$Component) {\n  _inherits(GoodDetail, _React$Component);\n\n  var _super = _createSuper(GoodDetail);\n\n  function GoodDetail(props) {\n    var _this$goodData, _this$goodData2, _this$goodData3, _this$goodData4, _this$goodData5, _this$goodData6, _this$goodData7, _this$goodData8, _this$goodData9, _this$goodData10, _this$goodData11, _this$goodData12, _this$goodData13, _this$goodData14, _this$goodData15, _this$goodData16;\n\n    var _this;\n\n    _classCallCheck(this, GoodDetail);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCityClick\", function (providerCityDeliveryType, shippingImage, shippingDesc, providerCityDeliveryPostTimeoutDay, providerCityText, selectedCountryId, selectedCityId, selectedProvinceId) {\n      _this.setState(function (state) {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          providerCityText: providerCityText,\n          selectedCityId: selectedCityId,\n          selectedCountryId: selectedCountryId,\n          selectedProvinceId: selectedProvinceId,\n          providerCityDeliveryType: providerCityDeliveryType,\n          shippingImage: shippingImage,\n          shippingDesc: shippingDesc,\n          providerCityDeliveryPostTimeoutDay: providerCityDeliveryPostTimeoutDay,\n          deliveryBoxLoading: false\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSelectedItemCount\", function (count) {\n      _this.setState({\n        selectedItemCount: count\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"addToCart\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var count, result, id, cartId;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              count = _this.state.selectedItemCount;\n              if (!count) count = 1;\n              _context.prev = 2;\n              _context.next = 5;\n              return client_addToCart({\n                goodId: _this.goodId,\n                providerId: _this.state.selectedProviderId,\n                cityId: _this.state.selectedCityId,\n                count: count,\n                countryId: _this.state.selectedCountryId,\n                provinceId: _this.state.selectedProvinceId\n              });\n\n            case 5:\n              result = _context.sent;\n\n              if (result.status === 200) {\n                id = result.result.cookieId;\n                cartId = Cookies.get(process.env.NEXT_PUBLIC_Token_Cookie_name_cart);\n\n                if (!cartId && id) {\n                  setCartCookie(id);\n                  axiosClient.setCartId(id);\n                }\n\n                _this.props.router.push(\"/\".concat(_this.props.curr, \"-\").concat(_this.props.lang, \"/cart\"));\n              }\n\n              _context.next = 11;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](2);\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 9]]);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDeliveryBoxLoading\", function (show) {\n      _this.setState({\n        deliveryBoxLoading: show\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleVariSelect\", function (newVariSelected, providerIndex) {\n      // this.setState({ variSelected: newVariSelected });\n      _this.setState(function (state) {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          selectedItemCount: 1,\n          variSelected: newVariSelected,\n          SelectedProviderIndex: providerIndex,\n          selectedProviderId: _this.goodData.goodsProviderVarity[providerIndex].providerId\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleNonMatchedVariSelect\", function (providerIndex) {\n      var newVariSelect = {};\n\n      _this.goodData.goodsProviderVarity[providerIndex].tGoodsVariety.forEach(function (vari) {\n        newVariSelect[vari.parameterTitle] = vari.fkVariationParameterValueId;\n      });\n\n      _this.setState(function (state) {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          selectedItemCount: 1,\n          variSelected: newVariSelect,\n          SelectedProviderIndex: providerIndex,\n          selectedProviderId: _this.goodData.goodsProviderVarity[providerIndex].providerId\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"openPanel\", function () {\n      _this.setState({\n        inProp: true\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"closePanel\", function () {\n      _this.setState({\n        inProp: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleLikeClick\", function (e) {\n      e.preventDefault();\n\n      if (!_this.props.isLogin) {\n        _this.props.saveLink(_this.props.router.asPath);\n\n        _this.props.router.push(\"/\".concat(_this.props.curr, \"-\").concat(_this.props.lang, \"/Auth\"));\n\n        return;\n      }\n\n      var result = client_likeGood(_this.goodId);\n\n      _this.setState({\n        itemLiked: !_this.state.itemLiked\n      });\n\n      var wishCount = _this.state.itemLiked ? _this.props.wishCount - 1 : _this.props.wishCount + 1;\n\n      _this.props.addWishCount(wishCount);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleBuyNow\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var count, result;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (_this.props.isLogin) {\n                _context2.next = 4;\n                break;\n              }\n\n              _this.props.saveLink(_this.props.router.asPath);\n\n              _this.props.router.push(\"/\".concat(_this.props.curr, \"-\").concat(_this.props.lang, \"/Auth\"));\n\n              return _context2.abrupt(\"return\");\n\n            case 4:\n              count = _this.state.selectedItemCount;\n              if (!count) count = 1;\n              _context2.prev = 6;\n              _context2.next = 9;\n              return client_addToCart({\n                goodId: _this.goodId,\n                providerId: _this.state.selectedProviderId,\n                cityId: _this.state.selectedCityId,\n                count: count,\n                countryId: _this.state.selectedCountryId,\n                provinceId: _this.state.selectedProvinceId,\n                oneClick: true\n              });\n\n            case 9:\n              result = _context2.sent;\n\n              if (result.status === 200) {\n                if (result.result.setOneClick) {\n                  _this.props.router.push(\"/\".concat(_this.props.curr, \"-\").concat(_this.props.lang, \"/order?to=pay\"));\n                } else {\n                  _this.props.router.push(\"/\".concat(_this.props.curr, \"-\").concat(_this.props.lang, \"/cart\"));\n                }\n              }\n\n              _context2.next = 15;\n              break;\n\n            case 13:\n              _context2.prev = 13;\n              _context2.t0 = _context2[\"catch\"](6);\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[6, 13]]);\n    })));\n\n    _this.lang = _this.props.lang;\n    _this.panelRef = /*#__PURE__*/React.createRef();\n    _this.goodData = _this.props.data;\n    _this.providerId = _this.goodData.goodsProviderVarity[0] && _this.goodData.goodsProviderVarity[0].providerId;\n    _this.goodId = _this.goodData.goodsId;\n\n    var _generatetGoodsVariet = generatetGoodsVarietyExistencePossibilityAndPrintStructure(_this.goodData.goodsProviderVarity),\n        _generatetGoodsVariet2 = _slicedToArray(_generatetGoodsVariet, 2),\n        printStructure = _generatetGoodsVariet2[0],\n        VarietyExistencePossibility = _generatetGoodsVariet2[1];\n\n    _this.VariSelected = {};\n\n    _this.goodData.goodsProviderVarity[0].tGoodsVariety.forEach(function (vari) {\n      _this.VariSelected[vari.parameterTitle] = vari.fkVariationParameterValueId;\n    });\n\n    _this.state = {\n      descriptionCalculateShopRate: (_this$goodData = _this.goodData) === null || _this$goodData === void 0 ? void 0 : _this$goodData.descriptionCalculateShopRate,\n      saleWithCall: (_this$goodData2 = _this.goodData) === null || _this$goodData2 === void 0 ? void 0 : _this$goodData2.saleWithCall,\n      isDownloadable: (_this$goodData3 = _this.goodData) === null || _this$goodData3 === void 0 ? void 0 : _this$goodData3.isDownloadable,\n      inProp: false,\n      variSelected: _this.VariSelected,\n      selectedItemCount: 1,\n      changeSelectedItemCount: _this.handleSelectedItemCount,\n      variPrintStructure: printStructure,\n      VarietyExistencePossibility: VarietyExistencePossibility,\n      handleVariSelect: _this.handleVariSelect,\n      handleNonMatchedVariSelect: _this.handleNonMatchedVariSelect,\n      SelectedProviderIndex: 0,\n      selectedProviderId: (_this$goodData4 = _this.goodData) === null || _this$goodData4 === void 0 ? void 0 : _this$goodData4.goodsProviderVarity[0].providerId,\n      providerShopId: (_this$goodData5 = _this.goodData) === null || _this$goodData5 === void 0 ? void 0 : _this$goodData5.goodsProviderVarity[0].fkShopId,\n      providerCityId: (_this$goodData6 = _this.goodData) === null || _this$goodData6 === void 0 ? void 0 : _this$goodData6.shopCityId,\n      selectedCityId: (_this$goodData7 = _this.goodData) === null || _this$goodData7 === void 0 ? void 0 : _this$goodData7.shopCityId,\n      selectedCountryId: (_this$goodData8 = _this.goodData) === null || _this$goodData8 === void 0 ? void 0 : _this$goodData8.shopCountryId,\n      providerCountryId: (_this$goodData9 = _this.goodData) === null || _this$goodData9 === void 0 ? void 0 : _this$goodData9.shopCountryId,\n      selectedProvinceId: (_this$goodData10 = _this.goodData) === null || _this$goodData10 === void 0 ? void 0 : _this$goodData10.shopProvinceId,\n      providerProvinceId: (_this$goodData11 = _this.goodData) === null || _this$goodData11 === void 0 ? void 0 : _this$goodData11.shopProvinceId,\n      providerCityText: (_this$goodData12 = _this.goodData) === null || _this$goodData12 === void 0 ? void 0 : _this$goodData12.shopCityTitle,\n      providerCityDeliveryType: (_this$goodData13 = _this.goodData) === null || _this$goodData13 === void 0 ? void 0 : _this$goodData13.goodsProviderVarity[0].shippingPossibilities,\n      providerCityDeliveryTypeImage: (_this$goodData14 = _this.goodData) === null || _this$goodData14 === void 0 ? void 0 : _this$goodData14.goodsProviderVarity[0].shippingImage,\n      providerCityDeliveryTypeDesc: (_this$goodData15 = _this.goodData) === null || _this$goodData15 === void 0 ? void 0 : _this$goodData15.goodsProviderVarity[0].shippingDesc,\n      providerCityDeliveryPostTimeoutDay: (_this$goodData16 = _this.goodData) === null || _this$goodData16 === void 0 ? void 0 : _this$goodData16.goodsProviderVarity[0].postTimeoutDay,\n      deliveryBoxLoading: false,\n      handleCityClick: _this.handleCityClick,\n      handleDeliveryBoxLoading: _this.handleDeliveryBoxLoading,\n      itemLiked: _this.goodData.like\n    };\n    return _this;\n  }\n\n  _createClass(GoodDetail, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      client_viewGood(this.goodId).then(function () {})[\"catch\"](function (err) {\n        console.log(err);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$goodData$parent,\n          _this$goodData17,\n          _this$goodData18,\n          _this2 = this;\n\n      return __jsx(GoodDetailContext.Provider, {\n        value: this.state\n      }, __jsx(\"div\", {\n        className: \"container siteWidthContainer\"\n      }, __jsx(DesktopsAndBigger, {\n        className: \"w-100\"\n      }, ((_this$goodData$parent = this.goodData.parentCategory) === null || _this$goodData$parent === void 0 ? void 0 : _this$goodData$parent.length) > 0 ? __jsx(BreadCrump, {\n        className: \"col-12 goods-details-Bread-crump\",\n        data: this.goodData.parentCategory,\n        isGoodsDetails: true,\n        goodsName: (_this$goodData17 = this.goodData) === null || _this$goodData17 === void 0 ? void 0 : _this$goodData17.title\n      }) : __jsx(\"div\", {\n        style: {\n          height: \"10px\",\n          width: \"100%\"\n        }\n      })), __jsx(\"div\", {\n        className: \"goodDetail\"\n      }, __jsx(CSSTransition, {\n        unmountOnExit: true,\n        \"in\": this.state.inProp,\n        timeout: 300,\n        classNames: \"goodDetail__panel--anim\",\n        nodeRef: this.panelRef\n      }, __jsx(DeliveryPanel, {\n        panelRef: this.panelRef,\n        closePanel: this.closePanel\n      })), __jsx(\"div\", {\n        className: \"row goodDetail__row\"\n      }, __jsx(\"section\", {\n        className: \"col-lg-9 col-12 goodDetail__row-p-0\"\n      }, __jsx(\"article\", {\n        className: \"goodDetail__left-top-cnt\"\n      }, __jsx(BoxStyle2, null, __jsx(ItemDetail, {\n        handleLikeClick: this.handleLikeClick,\n        openPanel: this.openPanel,\n        data: this.goodData\n      }))), __jsx(\"article\", {\n        className: \"goodDetail__left-bottom-cnt\"\n      }, __jsx(BoxStyle2, null, __jsx(GoodDetailTabs, {\n        description: (_this$goodData18 = this.goodData) === null || _this$goodData18 === void 0 ? void 0 : _this$goodData18.description\n      })))), __jsx(\"aside\", {\n        className: \"col-lg-3 col-12 goodDetail__aside\"\n      }, __jsx(BoxStyle2, null, __jsx(GoodDetailAside, {\n        data: this.goodData,\n        handleLikeClick: this.handleLikeClick,\n        addToCart: this.addToCart,\n        handleBuyNow: this.handleBuyNow,\n        providerId: this.providerId,\n        goodId: this.goodId,\n        shopDetailAccess: this.goodData.shopDetailAccess\n      })))), __jsx(\"section\", {\n        className: \"goodDetail__recommend\"\n      }, this.goodData.recommendation && __jsx(Translate, null, function (_ref3) {\n        var translate = _ref3.translate;\n        return __jsx(BoxStyle1, {\n          headerContent: translate(\"common.recommended\")\n        }, __jsx(GoodsSlider, {\n          reloadOnClick: true,\n          data: _this2.goodData.recommendation,\n          count: 6\n        }));\n      })))));\n    }\n  }]);\n\n  return GoodDetail;\n}(React.Component);\n\nvar mapDispatchToProps = {\n  saveLink: function saveLink(link) {\n    return {\n      type: PREVLINK_CHANGE,\n      payload: {\n        link: link\n      }\n    };\n  },\n  addWishCount: addWishCount\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    lang: selectLang(state),\n    curr: selectCurr(state),\n    isLogin: selectLogin(state).isLogin,\n    wishCount: selectWishCount(state)\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(GoodDetail));","map":null,"metadata":{},"sourceType":"module"}
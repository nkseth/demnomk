{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\"; // import \"./CreateShop.scss\";\n// import \"./CreateShop-rtl.scss\";\n\nimport { connect } from \"react-redux\";\nimport { Translate } from \"react-localize-redux\";\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { CreateShopContext } from \"./CreateShopContext\";\nimport classnames from \"classnames\";\nimport BackIcon from \"./../../../../assets/icons/back.svg\";\nimport { getErrorMsg } from \"../../../../lib/helpers\";\nimport { getToastConfig } from \"../../../../lib/toast\";\nimport logo from \"./../../../../assets/images/logo-2.png\";\nimport { client_submitShop } from \"./../../../../lib/api/client/clientShop\";\nimport { selectLang } from \"../../../../appConfigSlice\";\nimport { ToastContainer, toast } from \"react-toastify\";\nimport { LOGIN, COUNTRY, STORE, DOCUMENT, VAT, BANK, PREV, NEXT, COMPLETE_AND_NEXT, END, Langs } from \"./CreateShopConstant\";\nimport { CreateShopNav, Login, Country, Document, Store, Bank, Vat, End, CreateShopMobileNav } from \"./CreateShopLayouts\";\nimport { TabletsAndBigger, Tablets } from \"../../../../Responsive.js\";\nimport { switchLang } from \"../../../../lib/switch\";\n\nvar CreateShop = /*#__PURE__*/function (_React$Component) {\n  _inherits(CreateShop, _React$Component);\n\n  var _super = _createSuper(CreateShop);\n\n  function CreateShop(props) {\n    var _formState;\n\n    var _this;\n\n    _classCallCheck(this, CreateShop);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"handleLogin\", function (email, pass, mobileNumber, countryId, iso, phoneCode, countryName) {\n      _this.state.formData.email = email;\n      _this.state.formData.password = pass;\n      _this.state.formData.fkCountryId = countryId;\n      _this.state.formData.iso = iso;\n      _this.state.formData.phoneCode = phoneCode;\n      _this.state.formData.countryName = countryName;\n      _this.state.formData.phone = mobileNumber;\n      _this.state.formData.phone = mobileNumber;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCountry\", function (city, cityName, clearAddress, provinceId) {\n      _this.state.formData.fkCityId = city;\n      _this.state.formData.fkProvinceId = provinceId;\n      _this.state.formData.cityName = cityName;\n\n      if (clearAddress === true) {\n        _this.state.formData.address = '';\n        _this.state.formData.locationX = 0;\n        _this.state.formData.locationY = 0;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStore\", function (person, name, storename, address, cat, lat, lng) {\n      _this.state.formData.fkPersonId = person;\n      _this.state.formData.storeName = storename;\n      _this.state.formData.vendorUrlid = storename;\n      _this.state.formData.address = address;\n      _this.state.filesData.selectedCategory = cat;\n      _this.state.formData.locationX = lat;\n      _this.state.formData.locationY = lng;\n\n      if (person == 2) {\n        _this.state.formData.fullName = name;\n      } else {\n        _this.state.formData.companyName = name;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleBank\", function (ben, bank, branch, acc, iban, swift, curr, files, filesModel) {\n      _this.state.formData.bankBeneficiaryName = ben, _this.state.formData.bankName = bank, _this.state.formData.bankBranch = branch, _this.state.formData.bankAccountNumber = acc, _this.state.formData.bankIban = iban, _this.state.formData.bankSwiftCode = swift, _this.state.formData.fkCurrencyId = curr, _this.state.filesData.bankFileDto = filesModel, _this.state.filesData.bankFiles = files;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDocuments\", function (dto, files) {\n      _this.state.filesData.identityFileDto = dto;\n      _this.state.filesData.identityFiles = files;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleVat\", function (vat, dto, files) {\n      _this.state.formData.taxRegistrationNumber = vat;\n      _this.state.filesData.taxFileDto = dto;\n      _this.state.filesData.taxFiles = files;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStep\", function (type) {\n      var step, newFormState;\n      var curstep = _this.state.step;\n\n      if (type === COMPLETE_AND_NEXT) {\n        newFormState = _objectSpread(_objectSpread({}, _this.state.formState), {}, _defineProperty({}, curstep, _objectSpread(_objectSpread({}, _this.state.formState[curstep]), {}, {\n          active: false,\n          complete: true\n        })));\n        type = NEXT;\n      } else {\n        newFormState = _objectSpread(_objectSpread({}, _this.state.formState), {}, _defineProperty({}, curstep, _objectSpread(_objectSpread({}, _this.state.formState[curstep]), {}, {\n          active: false,\n          complete: false\n        })));\n      }\n\n      switch (type) {\n        case NEXT:\n          step = curstep >= 7 ? 7 : curstep + 1;\n          break;\n\n        case PREV:\n          step = curstep <= 1 ? 1 : curstep - 1;\n          break;\n\n        case LOGIN:\n          step = LOGIN;\n          break;\n\n        case COUNTRY:\n          step = COUNTRY;\n          break;\n\n        case STORE:\n          step = STORE;\n          break;\n\n        case DOCUMENT:\n          step = DOCUMENT;\n          break;\n\n        case BANK:\n          step = BANK;\n          break;\n\n        case VAT:\n          step = VAT;\n          break;\n\n        case END:\n          step = END;\n          break;\n\n        default:\n          step = curstep >= 7 ? 7 : curstep + 1;\n          break;\n      }\n\n      newFormState[step].active = true; // update NEXT_OR_PREV\n\n      _this.NEXT_OR_PREV = step >= curstep ? NEXT : PREV;\n\n      _this.setState({\n        step: step,\n        formState: newFormState\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleLastStep\", function () {\n      if (_this.state.step == 6) {\n        _this.child.handleVatFromParent();\n      }\n    });\n\n    var formState = (_formState = {}, _defineProperty(_formState, LOGIN, {\n      complete: true,\n      active: true,\n      id: uuidv4()\n    }), _defineProperty(_formState, COUNTRY, {\n      complete: false,\n      active: false,\n      id: uuidv4()\n    }), _defineProperty(_formState, STORE, {\n      complete: false,\n      active: false,\n      id: uuidv4()\n    }), _defineProperty(_formState, DOCUMENT, {\n      complete: false,\n      active: false,\n      id: uuidv4()\n    }), _defineProperty(_formState, BANK, {\n      complete: false,\n      active: false,\n      id: uuidv4()\n    }), _defineProperty(_formState, VAT, {\n      complete: false,\n      active: false,\n      id: uuidv4()\n    }), _defineProperty(_formState, END, {\n      complete: false,\n      active: false,\n      id: uuidv4()\n    }), _formState);\n    var formData = {\n      email: \"\",\n      password: \"\",\n      fkCountryId: 0,\n      fkProvinceId: 0,\n      fkCityId: 0,\n      cityName: \"\",\n      fkPersonId: 0,\n      companyName: \"\",\n      fullName: \"\",\n      storeName: \"\",\n      address: \"\",\n      locationX: 0,\n      locationY: 0,\n      bankBeneficiaryName: \"\",\n      bankName: \"\",\n      bankBranch: \"\",\n      bankAccountNumber: \"\",\n      bankIban: \"\",\n      bankSwiftCode: \"\",\n      fkCurrencyId: 0,\n      taxRegistrationNumber: \"\",\n      shopId: 0,\n      fkStatusId: 1,\n      vendorUrlid: \"\",\n      phone: \"\",\n      tShopCategory: [],\n      tShopFiles: []\n    };\n    var filesData = {\n      selectedCategory: null,\n      identityFileDto: [],\n      identityFiles: [],\n      bankFileDto: [],\n      bankFiles: [],\n      taxFileDto: [],\n      taxFiles: []\n    };\n    _this.NEXT_OR_PREV = NEXT;\n    _this.state = {\n      step: LOGIN,\n      formData: formData,\n      filesData: filesData,\n      handleStep: _this.handleStep,\n      handleLogin: _this.handleLogin,\n      handleCountry: _this.handleCountry,\n      handleStore: _this.handleStore,\n      handleDocuments: _this.handleDocuments,\n      handleBank: _this.handleBank,\n      handleVat: _this.handleVat,\n      finalSubmit: _this.finalSubmit,\n      formState: formState,\n      lang: _this.props.lang\n    };\n    _this.finalSubmit = _this.finalSubmit.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(CreateShop, [{\n    key: \"finalSubmit\",\n    value: function () {\n      var _finalSubmit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var filesDto, formData, allFiles, fileIndex, result;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                filesDto = this.filesData.identityFileDto.concat(this.filesData.bankFileDto, this.filesData.taxFileDto);\n                filesDto.forEach(function (v) {\n                  delete v.index;\n                });\n                this.formData.tShopFiles = filesDto;\n                this.formData.tShopCategory = [];\n                this.formData.tShopCategory.push({\n                  shopCategoryId: 0,\n                  fkShopId: 0,\n                  fkCategoryId: this.filesData.selectedCategory.value\n                });\n                formData = new FormData();\n                allFiles = this.filesData.identityFiles.concat(this.filesData.bankFiles, this.filesData.taxFiles); // حذف کردن فایل های خالی\n\n                fileIndex = [];\n                allFiles = allFiles.filter(function (el, index) {\n                  if (el === null) {\n                    fileIndex.push(index);\n                  }\n\n                  return el != null;\n                });\n                this.formData.tShopFiles = this.formData.tShopFiles.filter(function (item, index) {\n                  return item.FileUrl !== '';\n                });\n                allFiles.forEach(function (element) {\n                  formData.append(\"FilesDto\", element);\n                });\n                formData.append(\"Shop\", JSON.stringify(this.formData));\n                _context.prev = 12;\n                _context.next = 15;\n                return client_submitShop(formData);\n\n              case 15:\n                result = _context.sent;\n\n                if (!(result.status === 200)) {\n                  _context.next = 20;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", true);\n\n              case 20:\n                toast.error(result.message, getToastConfig());\n                return _context.abrupt(\"return\", false);\n\n              case 22:\n                _context.next = 28;\n                break;\n\n              case 24:\n                _context.prev = 24;\n                _context.t0 = _context[\"catch\"](12);\n                toast.error(getErrorMsg(this.lang, \"error-create-shop\"), getToastConfig());\n                return _context.abrupt(\"return\", false);\n\n              case 28:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[12, 24]]);\n      }));\n\n      function finalSubmit() {\n        return _finalSubmit.apply(this, arguments);\n      }\n\n      return finalSubmit;\n    }()\n  }, {\n    key: \"renderSubNav\",\n    value: function renderSubNav() {\n      var _this2 = this;\n\n      var needBack = this.state.step !== LOGIN && this.state.step !== END ? true : false;\n      return __jsx(\"header\", {\n        className: \"createshop__subnav align-items-center d-flex justify-content-between\"\n      }, __jsx(\"div\", {\n        className: \"createshop__prev-cnt\"\n      }, __jsx(TabletsAndBigger, null, needBack && __jsx(\"div\", {\n        onClick: function onClick() {\n          _this2.handleStep(PREV);\n\n          _this2.handleLastStep();\n        },\n        className: \"text-align-right\",\n        style: {\n          cursor: \"pointer\"\n        }\n      }, __jsx(BackIcon, {\n        className: \"createshop__back-icon\"\n      }), __jsx(Translate, {\n        id: \"subheader.back\"\n      })))), __jsx(\"a\", {\n        href: \"/\",\n        className: \"align-self-center createshop__logo-cnt\"\n      }, this.state.step !== END && __jsx(\"img\", {\n        src: logo,\n        alt: \"logo jyal\",\n        className: \"createshop__logo\"\n      })), __jsx(\"span\", {\n        style: {\n          cursor: \"pointer\"\n        },\n        onClick: function onClick(e) {\n          e.preventDefault();\n          switchLang(_this2.props.loc, true);\n        },\n        className: \"createshop__lang\"\n      }, Langs[this.props.lang]));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var content; // height = \"400px\";\n\n      switch (this.state.step) {\n        case LOGIN:\n          content = __jsx(Login, null);\n          break;\n\n        case COUNTRY:\n          content = __jsx(Country, null);\n          break;\n\n        case STORE:\n          content = __jsx(Store, {\n            lang: this.props.lang\n          });\n          break;\n\n        case DOCUMENT:\n          content = __jsx(Document, null);\n          break;\n\n        case BANK:\n          content = __jsx(Bank, null);\n          break;\n\n        case VAT:\n          content = __jsx(Vat, {\n            ref: function ref(Ref) {\n              return _this3.child = Ref;\n            }\n          });\n          break;\n\n        case END:\n          content = __jsx(End, null);\n          break;\n\n        default:\n          content = __jsx(Login, null);\n      }\n\n      return __jsx(\"div\", null, __jsx(\"section\", {\n        className: \"createshop\"\n      }, __jsx(CreateShopContext.Provider, {\n        value: this.state\n      }, __jsx(Tablets, null, __jsx(CreateShopMobileNav, null)), __jsx(\"div\", {\n        className: \"createshop__box\"\n      }, __jsx(TabletsAndBigger, null, __jsx(CreateShopNav, null)), this.renderSubNav(), __jsx(TransitionGroup // style={\n      //   {\n      //     // height: height,\n      //   }\n      // }\n      , {\n        className: classnames(\"createshop__rel\", {\n          next: this.NEXT_OR_PREV === NEXT,\n          prev: this.NEXT_OR_PREV === PREV\n        })\n      }, __jsx(ToastContainer, _extends({\n        rtl: this.is_rtl\n      }, getToastConfig())), __jsx(CSSTransition, {\n        key: this.state.formState[this.state.step].id,\n        timeout: 300,\n        className: \"createshop__anim\"\n      }, content))))));\n    }\n  }]);\n\n  return CreateShop;\n}(React.Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    lang: selectLang(state)\n  };\n};\n\nexport default connect(mapStateToProps)(CreateShop);","map":null,"metadata":{},"sourceType":"module"}
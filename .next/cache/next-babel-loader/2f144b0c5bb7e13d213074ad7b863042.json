{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport { Translate } from \"react-localize-redux\"; // import \"./CartAndWishlist.scss\";\n// import \"./CartAndWishlist-rtl.scss\";\n\nimport { connect } from \"react-redux\";\nimport { BoxStyle1, Button, Loading } from \"../../../common\";\nimport { CartAndWishlistItem, CartAndWishlistAside, EmptyCart } from \"./CartAndWishlistLayouts\";\nimport { fetchCart, selectStatus, IDLE, selectCart, ERROR, fetchWishList, selectWishListStatus, selectWishList, selectCityId, selectCityText, selectCountryId, cityChanged, addCoupon, selectCoupon, selectErrorMsg } from \"./cartAndWishlistSlice\";\nimport { selectLang, LOADING, selectCurr, selectLogin, PREVLINK_CHANGE } from \"../../../../appConfigSlice\";\nimport { CSSTransition } from \"react-transition-group\";\nimport DeliveryPanel from \"./CartAndWishlistLayouts/DeliveryPanel/DeliveryPanel\";\nimport { client_addItemCount, client_addToCart, client_likeGood, client_removeFromCart } from \"../../../../lib/api/client/clientCart\";\nimport { toast, ToastContainer } from \"react-toastify\";\nimport { getToastConfig } from \"../../../../lib/toast\";\nimport { isRtl } from \"../../../../lib/isRtl\";\nimport { formatMoney, removeCouponCookie, setCouponCookie } from \"../../../../lib/helpers\";\nimport { withRouter } from \"next/router\";\nimport Cookies from \"js-cookie\";\nimport { unwrapResult } from \"@reduxjs/toolkit\";\n\nvar CardAndWhishlist = /*#__PURE__*/function (_React$Component) {\n  _inherits(CardAndWhishlist, _React$Component);\n\n  var _super = _createSuper(CardAndWhishlist);\n\n  function CardAndWhishlist(props) {\n    var _this;\n\n    _classCallCheck(this, CardAndWhishlist);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"openPanel\", function () {\n      _this.setState({\n        inProp: true\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"closePanel\", function () {\n      _this.setState({\n        inProp: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"removeItemFromCart\", /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(goodItemId) {\n        var result;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return client_removeFromCart(goodItemId);\n\n              case 3:\n                result = _context.sent;\n\n                if (result.status === 200) {\n                  _this.props.fetchCart({\n                    code: _this.props.coupon\n                  });\n                }\n\n                _context.next = 9;\n                break;\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](0);\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 7]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleItemQuantityChange\", /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(count, goodId, providerId) {\n        var result;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return client_addItemCount({\n                  goodsId: goodId,\n                  providerId: providerId,\n                  number: count,\n                  cityId: _this.props.cityId,\n                  countryId: _this.props.countryId,\n                  provinceId: _this.props.provinceId\n                });\n\n              case 3:\n                result = _context2.sent;\n\n                if (result.status === 200) {\n                  _this.props.fetchCart({\n                    code: _this.props.coupon,\n                    city: _this.props.cityId,\n                    country: _this.props.countryId,\n                    province: _this.props.provinceId\n                  });\n                }\n\n                _context2.next = 9;\n                break;\n\n              case 7:\n                _context2.prev = 7;\n                _context2.t0 = _context2[\"catch\"](0);\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[0, 7]]);\n      }));\n\n      return function (_x2, _x3, _x4) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleRemoveFromWishlist\", /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(goodId) {\n        var result;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return client_likeGood(goodId);\n\n              case 2:\n                result = _context3.sent;\n\n                if (result.status === 200) {\n                  _this.props.fetchWishList();\n                }\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x5) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleMoveWishToCart\", /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(goodId, providerId) {\n        var result;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                _context4.next = 3;\n                return client_addToCart({\n                  goodId: goodId,\n                  providerId: providerId,\n                  count: 1,\n                  countryId: _this.props.countryId,\n                  cityId: _this.props.cityId\n                });\n\n              case 3:\n                result = _context4.sent;\n\n                if (result.status === 200) {\n                  _this.props.fetchCart({\n                    code: _this.props.coupon,\n                    city: _this.props.cityId,\n                    country: _this.props.countryId,\n                    province: _this.props.provinceId\n                  });\n                }\n\n                _context4.next = 9;\n                break;\n\n              case 7:\n                _context4.prev = 7;\n                _context4.t0 = _context4[\"catch\"](0);\n\n              case 9:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, null, [[0, 7]]);\n      }));\n\n      return function (_x6, _x7) {\n        return _ref4.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCouponClick\", /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(couponCode) {\n        var result;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.prev = 0;\n                _context5.next = 3;\n                return _this.props.fetchCart({\n                  code: couponCode,\n                  city: _this.props.cityId,\n                  country: _this.props.countryId,\n                  province: _this.props.provinceId\n                });\n\n              case 3:\n                result = _context5.sent;\n                unwrapResult(result);\n\n                _this.props.addCoupon(couponCode);\n\n                if (couponCode) {\n                  setCouponCookie(couponCode);\n                } else {\n                  removeCouponCookie();\n                }\n\n                _context5.next = 12;\n                break;\n\n              case 9:\n                _context5.prev = 9;\n                _context5.t0 = _context5[\"catch\"](0);\n                console.log(_context5.t0);\n\n              case 12:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, null, [[0, 9]]);\n      }));\n\n      return function (_x8) {\n        return _ref5.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCityChange\", /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(countryId, provinceId, cityId, cityText) {\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _this.props.cityChanged({\n                  cityId: cityId,\n                  countryId: countryId,\n                  cityText: cityText\n                });\n\n                _this.props.fetchCart({\n                  code: _this.props.coupon,\n                  city: cityId,\n                  country: countryId,\n                  province: provinceId\n                });\n\n              case 2:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }));\n\n      return function (_x9, _x10, _x11, _x12) {\n        return _ref6.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCheckOutClick\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n      var digitalFile, downloadAbleItem;\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              if (_this.props.isLogin) {\n                _context7.next = 4;\n                break;\n              }\n\n              _this.props.prevUrlChange(_this.props.router.asPath);\n\n              _this.props.router.push(\"/\".concat(_this.props.curr, \"-\").concat(_this.props.lang, \"/Auth\"));\n\n              return _context7.abrupt(\"return\");\n\n            case 4:\n              digitalFile = false;\n              downloadAbleItem = _this.props.cart.items.filter(function (x) {\n                return x.isDownloadable;\n              });\n\n              if (downloadAbleItem.length == _this.props.cart.items.length) {\n                digitalFile = true;\n              }\n\n              if (digitalFile) {\n                _this.props.router.push(\"/\".concat(_this.props.curr, \"-\").concat(_this.props.lang, \"/order?to=downloadable\"));\n              } else {\n                _this.props.router.push(\"/\".concat(_this.props.curr, \"-\").concat(_this.props.lang, \"/order\"));\n              }\n\n            case 8:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7);\n    })));\n\n    _this.state = {\n      cartLoading: false,\n      inProp: false,\n      changeCityLoading: false,\n      mobileCheckoutLoading: false\n    };\n    _this.panelRef = /*#__PURE__*/React.createRef();\n    return _this;\n  }\n\n  _createClass(CardAndWhishlist, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var coupon = Cookies.get(process.env.NEXT_PUBLIC_Token_Cookie_name_coupon);\n\n      if (coupon) {\n        this.props.addCoupon(coupon);\n      }\n\n      this.props.fetchCart({\n        code: coupon\n      });\n      this.props.fetchWishList();\n    }\n  }, {\n    key: \"renderCartBoxHeader\",\n    value: function renderCartBoxHeader() {\n      return __jsx(\"div\", {\n        className: \"cart__header-container\"\n      }, this.props.cart.itemsCount !== 0 && __jsx(\"div\", {\n        className: \"itemDetail__deli-cnt cart__deli-cnt\"\n      }, this.state.changeCityLoading ? __jsx(Loading, {\n        type: \"gray\",\n        width: \"20px\",\n        height: \"20px\"\n      }) : __jsx(React.Fragment, null, __jsx(\"div\", {\n        className: \"itemDetail__item\"\n      }, __jsx(\"span\", {\n        className: \"item-currect-address-1\"\n      }, __jsx(Translate, {\n        id: \"deliver.deliverCurrect\"\n      })), __jsx(\"span\", {\n        className: \"itemDetail__item-small-text d-flex\"\n      }, __jsx(Translate, {\n        id: \"deliver.deliverTo\"\n      }), __jsx(\"span\", {\n        className: \"itemDetail__item-small-text itemDetail__item-small-text--bold\"\n      }, this.props.cityText)), __jsx(\"span\", {\n        className: \"itemDetail__link mr-3 ml-3\",\n        onClick: this.openPanel\n      }, __jsx(Translate, {\n        id: \"deliver.changeAre\"\n      }))), __jsx(\"span\", {\n        className: \"item-currect-address-2\"\n      }, __jsx(Translate, {\n        id: \"deliver.deliverCurrect\"\n      })))), __jsx(\"h2\", {\n        className: \"cart__box-header\"\n      }, __jsx(Translate, {\n        id: \"cart-cart.mycart\"\n      })), __jsx(\"p\", {\n        className: \"cart__box-subheader\"\n      }, this.props.cart.itemsCount, \"\\xA0\", this.props.cart.itemsCount > 1 ? __jsx(Translate, {\n        id: \"cart-cart.items\"\n      }) : __jsx(Translate, {\n        id: \"cart-cart.item\"\n      })));\n    }\n  }, {\n    key: \"renderWishlistBoxHeader\",\n    value: function renderWishlistBoxHeader() {\n      return __jsx(\"div\", {\n        className: \"cart__header-container\"\n      }, __jsx(\"h2\", {\n        className: \"cart__box-header\"\n      }, __jsx(Translate, {\n        id: \"cart-wishlist.mywishlist\"\n      })), __jsx(\"p\", {\n        className: \"cart__box-subheader\"\n      }, this.props.wishList.length, \"\\xA0\", this.props.wishList.length > 1 ? __jsx(Translate, {\n        id: \"cart-cart.items\"\n      }) : __jsx(Translate, {\n        id: \"cart-cart.item\"\n      })));\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      if (this.props.cartStatus === ERROR) {\n        toast.error(this.props.errorText, getToastConfig());\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props$cart,\n          _this$props$cart2,\n          _this$props$cart3,\n          _this2 = this,\n          _this$props$cart4,\n          _this$props$cart5;\n\n      var load = __jsx(Loading, {\n        type: \"gray\",\n        width: \"80px\",\n        styleSheet: {\n          margin: \"100px auto\"\n        }\n      });\n\n      if (this.state.cartLoading) {\n        return __jsx(React.Fragment, null, load);\n      }\n\n      if (this.props.isLogin) {\n        if (this.props.cartLoading || this.props.wishListLoading) {\n          return __jsx(React.Fragment, null, load);\n        }\n      } else {\n        if (this.props.cartLoading) return __jsx(React.Fragment, null, load);\n      }\n\n      if (!this.props.isLogin && this.props.cart.itemsCount === 0) {\n        return __jsx(EmptyCart, {\n          icon: true,\n          dark: true,\n          p1: __jsx(Translate, {\n            id: \"emptyshop\"\n          }),\n          p2: __jsx(Translate, {\n            id: \"startshopping\"\n          }),\n          history: this.props.router\n        });\n      }\n\n      if (this.props.isLogin) {\n        if (this.props.cart.itemsCount === 0 && this.props.wishList.length === 0) {\n          return __jsx(EmptyCart, {\n            icon: true,\n            dark: true,\n            p1: __jsx(Translate, {\n              id: \"emptyshop\"\n            }),\n            p2: __jsx(Translate, {\n              id: \"startshopping\"\n            }),\n            history: this.props.router\n          });\n        }\n      }\n\n      return __jsx(\"section\", {\n        className: \"container siteWidthContainer cart-wishlist-section\"\n      }, __jsx(ToastContainer, _extends({\n        rtl: isRtl(this.props.lang)\n      }, getToastConfig())), __jsx(CSSTransition, {\n        unmountOnExit: true,\n        \"in\": this.state.inProp,\n        timeout: 300,\n        classNames: \"goodDetail__panel--anim\",\n        nodeRef: this.panelRef\n      }, __jsx(DeliveryPanel, {\n        panelRef: this.panelRef,\n        closePanel: this.closePanel,\n        countryId: this.props.cart.countryId,\n        provinceId: this.props.cart.provinceId,\n        handleCityChange: this.handleCityChange\n      })), __jsx(\"div\", {\n        className: \"row no-gutters\"\n      }, __jsx(\"div\", {\n        className: ((_this$props$cart = this.props.cart) === null || _this$props$cart === void 0 ? void 0 : _this$props$cart.itemsCount) > 0 ? \"col-12 col-xl-9\" : \"col\"\n      }, __jsx(BoxStyle1, {\n        headerContent: this.renderCartBoxHeader()\n      }, __jsx(\"div\", {\n        className: \"cart\"\n      }, ((_this$props$cart2 = this.props.cart) === null || _this$props$cart2 === void 0 ? void 0 : _this$props$cart2.itemsCount) <= 0 ? __jsx(EmptyCart, {\n        normal: true,\n        p1: __jsx(Translate, {\n          id: \"emptyshop\"\n        }),\n        p2: __jsx(Translate, {\n          id: \"have-wish\"\n        }),\n        history: this.props.router\n      }) : __jsx(React.Fragment, null, (_this$props$cart3 = this.props.cart) === null || _this$props$cart3 === void 0 ? void 0 : _this$props$cart3.items.map(function (item, index) {\n        return __jsx(CartAndWishlistItem, _extends(_defineProperty({\n          key: index,\n          removeItemFromCart: _this2.removeItemFromCart,\n          handleItemQuantityChange: _this2.handleItemQuantityChange,\n          showQuantity: true\n        }, \"key\", item.itemId), item));\n      })))), this.props.isLogin ? this.props.wishListLoading ? __jsx(Loading, {\n        type: \"gray\",\n        width: \"50px\",\n        height: \"50px\",\n        styleSheet: {\n          margin: \"80px auto\"\n        }\n      }) : __jsx(BoxStyle1, {\n        headerContent: this.renderWishlistBoxHeader()\n      }, this.props.wishList.length > 0 ? __jsx(\"div\", {\n        className: \"cart\"\n      }, this.props.wishList.map(function (item, index) {\n        return __jsx(CartAndWishlistItem, _extends({\n          key: index,\n          handleRemoveFromWishlist: _this2.handleRemoveFromWishlist,\n          handleMoveWishToCart: _this2.handleMoveWishToCart,\n          wishlistItem: true\n        }, item));\n      })) : __jsx(EmptyCart, {\n        normal: true,\n        p1: __jsx(Translate, {\n          id: \"emptyWish\"\n        }),\n        p2: \"\",\n        history: this.props.router\n      })) : null, !this.props.isLogin && __jsx(BoxStyle1, {\n        headerContent: this.renderWishlistBoxHeader()\n      }, __jsx(\"div\", {\n        className: \"cart\"\n      }, __jsx(EmptyCart, {\n        normal: true,\n        p1: __jsx(Translate, {\n          id: \"emptyWish\"\n        }),\n        p2: __jsx(Translate, {\n          id: \"login-wish\"\n        }),\n        history: this.props.router\n      })))), ((_this$props$cart4 = this.props.cart) === null || _this$props$cart4 === void 0 ? void 0 : _this$props$cart4.itemsCount) > 0 && __jsx(\"div\", {\n        className: \"col-12 col-xl-3\"\n      }, __jsx(CartAndWishlistAside, {\n        data: this.props.cart,\n        addCoupon: this.handleCouponClick,\n        checkOut: this.handleCheckOutClick\n      }), __jsx(\"div\", {\n        className: \"checkout-fix\"\n      }, __jsx(Button, {\n        radius: \"true\",\n        onClick: function onClick() {\n          _this2.setState({\n            mobileCheckoutLoading: true\n          });\n\n          _this2.handleCheckOutClick();\n        },\n        value: this.state.mobileCheckoutLoading ? __jsx(Loading, {\n          type: \"white\",\n          \"with\": \"20px\",\n          height: \"20px\"\n        }) : __jsx(React.Fragment, null, __jsx(Translate, {\n          id: \"aside.buy\"\n        }), \"\\xA0\", (_this$props$cart5 = this.props.cart) === null || _this$props$cart5 === void 0 ? void 0 : _this$props$cart5.itemsCount, \"\\xA0\", __jsx(Translate, {\n          id: \"aside.items\"\n        }), \"\\xA0\", __jsx(\"span\", null, __jsx(Translate, {\n          id: this.props.curr\n        }), \"\\xA0 \", formatMoney(this.props.cart.total)))\n      })))));\n    }\n  }]);\n\n  return CardAndWhishlist;\n}(React.Component);\n\nvar prevUrlChange = function prevUrlChange(url) {\n  return {\n    type: PREVLINK_CHANGE,\n    payload: {\n      link: url\n    }\n  };\n};\n\nvar mapDispatchToProps = {\n  prevUrlChange: prevUrlChange,\n  fetchCart: fetchCart,\n  cityChanged: cityChanged,\n  fetchWishList: fetchWishList,\n  addCoupon: addCoupon\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    lang: selectLang(state),\n    curr: selectCurr(state),\n    cartLoading: selectStatus(state) === LOADING || selectStatus(state) === IDLE,\n    cartStatus: selectStatus(state),\n    cart: selectCart(state),\n    isLogin: selectLogin(state).isLogin,\n    wishListLoading: selectWishListStatus(state) === LOADING || selectWishListStatus(state) === IDLE,\n    wishList: selectWishList(state),\n    countryId: selectCountryId(state),\n    cityId: selectCityId(state),\n    cityText: selectCityText(state),\n    coupon: selectCoupon(state),\n    errorText: selectErrorMsg(state)\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(CardAndWhishlist));","map":null,"metadata":{},"sourceType":"module"}
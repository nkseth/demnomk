{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _extraReducers;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { createSlice, createAsyncThunk, createAction } from \"@reduxjs/toolkit\";\nimport { client_fetchSearch } from \"../../../../lib/api/client/clientSearch\";\nimport { searchPageFiltersDefaults, SEARCH_TYPE_CATEGORY } from \"../../../../lib/querys\";\nexport var LOADING = \"loading\";\nexport var IDLE = \"idle\";\nexport var SUCCEEDED = \"succeeded\";\nexport var ERROR = \"error\";\nexport var initialState = {\n  status: IDLE,\n  error: null,\n  search: {\n    goods: {\n      count: 0,\n      data: []\n    }\n  },\n  changeUrl: false,\n  filters: searchPageFiltersDefaults,\n  brands: {\n    items: [],\n    selected: []\n  }\n}; //// selectors\n\nexport var selectFilters = function selectFilters(state) {\n  return state.search.filters;\n};\nexport var selectGoods = function selectGoods(state) {\n  return state.search.search.goods;\n};\nexport var selectSearch = function selectSearch(state) {\n  return state.search.search;\n};\nexport var selectSpecs = function selectSpecs(state) {\n  return state.search.search.specs;\n};\nexport var selectBrands = function selectBrands(state) {\n  return state.search.brands.items;\n};\nexport var selectSelectedBrands = function selectSelectedBrands(state) {\n  return state.search.brands.selected;\n}; /// server action creator\n\nexport var serverSearchUpdate = createAction(\"search/serverUpdate\"); //// thunk actions\n\nexport var fetchSearch = createAsyncThunk(\"search/fetchSearch\", /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(data, _ref) {\n    var dispatch, result;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            dispatch = _ref.dispatch;\n            dispatch(changeUrl());\n            _context.next = 4;\n            return client_fetchSearch(data);\n\n          case 4:\n            result = _context.sent;\n            return _context.abrupt(\"return\", result);\n\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x, _x2) {\n    return _ref2.apply(this, arguments);\n  };\n}()); /// search slice\n\nvar searchSlice = createSlice({\n  name: \"search\",\n  initialState: initialState,\n  reducers: {\n    changeUrl: function changeUrl(state) {\n      state.changeUrl = !state.changeUrl;\n    },\n    orderByTypeAdded: function orderByTypeAdded(state, action) {\n      state.filters.orderByType = action.payload;\n    },\n    pageSizeAdded: function pageSizeAdded(state, action) {\n      state.filters.pageSize = action.payload;\n    },\n    priceAdded: function priceAdded(state, action) {\n      state.filters.fromPrice = action.payload.fromPrice;\n      state.filters.toPrice = action.payload.toPrice;\n    },\n    goodsCreatedDayAdded: function goodsCreatedDayAdded(state, action) {\n      state.filters.goodsCreatedDay = action.payload;\n    },\n    goodsOptionsAdded: function goodsOptionsAdded(state, action) {\n      state.filters.optionIds = action.payload;\n    },\n    brandsChanged: function brandsChanged(state, action) {\n      var id = parseInt(action.payload.brand.id);\n\n      if (action.payload.checked) {\n        state.filters.brandId.push(id);\n        state.brands.selected.push(action.payload.brand);\n      } else {\n        // if is remove\n        var newSelected = state.brands.selected.filter(function (brand) {\n          return brand.id != id;\n        });\n        var index = state.filters.brandId.indexOf(id);\n\n        if (index > -1) {\n          state.filters.brandId.splice(index, 1);\n        }\n\n        state.brands.selected = newSelected;\n      }\n    },\n    pageChanged: function pageChanged(state, action) {\n      state.filters.pageNumber = action.payload;\n    },\n    mobileFilterUpdate: function mobileFilterUpdate(state, action) {\n      var specsId = action.payload.specsId;\n      var arrival = action.payload.arrival;\n      var priceFrom = action.payload.price.min || state.filters.fromPrice;\n      var priceTo = action.payload.price.max || state.filters.toPrice;\n      state.filters.brandId = action.payload.brands.ids;\n      state.brands.selected = action.payload.brands.selected;\n      state.filters.optionIds = specsId;\n      state.filters.goodsCreatedDay = parseInt(arrival);\n      state.filters.fromPrice = parseInt(priceFrom);\n      state.filters.toPrice = parseInt(priceTo);\n      state.filters.justExist = action.payload.justExist;\n    },\n    categoryClick: function categoryClick(state, action) {\n      state.filters.id = action.payload;\n      state.filters.type = SEARCH_TYPE_CATEGORY;\n    },\n    changeJustExist: function changeJustExist(state, action) {\n      state.filters.justExist = action.payload;\n    }\n  },\n  extraReducers: (_extraReducers = {}, _defineProperty(_extraReducers, fetchSearch.pending, function (state, action) {\n    state.status = LOADING;\n  }), _defineProperty(_extraReducers, fetchSearch.fulfilled, function (state, action) {\n    var _result$specs, _result$brands;\n\n    state.status = SUCCEEDED;\n    var result = action.payload.result; //// generate optimize specs\n\n    var newSpecs = {};\n    (_result$specs = result.specs) === null || _result$specs === void 0 ? void 0 : _result$specs.forEach(function (spec) {\n      var _spec$options;\n\n      var newOptions = {};\n      (_spec$options = spec.options) === null || _spec$options === void 0 ? void 0 : _spec$options.forEach(function (option) {\n        newOptions[option.optionId] = option;\n      });\n      newSpecs[spec.specId] = _objectSpread(_objectSpread({}, spec), {}, {\n        options: newOptions\n      });\n    }); //// generate optimized brands\n\n    var newBrands = {};\n    (_result$brands = result.brands) === null || _result$brands === void 0 ? void 0 : _result$brands.forEach(function (brand) {\n      newBrands[brand.brandId] = brand;\n    });\n    result.specs = newSpecs;\n    result.brands = newBrands;\n    state.search = result;\n  }), _defineProperty(_extraReducers, fetchSearch.rejected, function (state, action) {\n    state.status = ERROR;\n  }), _defineProperty(_extraReducers, serverSearchUpdate, function (state, action) {\n    var _result$specs2, _result$brands2, _action$payload$brand;\n\n    var result = action.payload.search;\n    var newSpecs = {};\n    (_result$specs2 = result.specs) === null || _result$specs2 === void 0 ? void 0 : _result$specs2.forEach(function (spec) {\n      var _spec$options2;\n\n      var newOptions = {};\n      (_spec$options2 = spec.options) === null || _spec$options2 === void 0 ? void 0 : _spec$options2.forEach(function (option) {\n        newOptions[option.optionId] = option;\n      });\n      newSpecs[spec.specId] = _objectSpread(_objectSpread({}, spec), {}, {\n        options: newOptions\n      });\n    }); //// generate optimized brands\n\n    var newBrands = {};\n    (_result$brands2 = result.brands) === null || _result$brands2 === void 0 ? void 0 : _result$brands2.forEach(function (brand) {\n      newBrands[brand.brandId] = brand;\n    }); // generate selected brands\n\n    var selectedBrands = [];\n    (_action$payload$brand = action.payload.brands) === null || _action$payload$brand === void 0 ? void 0 : _action$payload$brand.forEach(function (brand) {\n      selectedBrands.push({\n        value: brand.brandTitle,\n        id: brand.brandId\n      });\n    });\n    result.brands = newBrands;\n    result.specs = newSpecs;\n    state.status = SUCCEEDED;\n    state.search = result;\n    state.filters = action.payload.filters;\n    state.brands.selected = selectedBrands;\n  }), _extraReducers)\n});\nvar _searchSlice$actions = searchSlice.actions,\n    orderByTypeAdded = _searchSlice$actions.orderByTypeAdded,\n    pageSizeAdded = _searchSlice$actions.pageSizeAdded,\n    priceAdded = _searchSlice$actions.priceAdded,\n    goodsCreatedDayAdded = _searchSlice$actions.goodsCreatedDayAdded,\n    changeUrl = _searchSlice$actions.changeUrl,\n    goodsOptionsAdded = _searchSlice$actions.goodsOptionsAdded,\n    brandsChanged = _searchSlice$actions.brandsChanged,\n    pageChanged = _searchSlice$actions.pageChanged,\n    mobileFilterUpdate = _searchSlice$actions.mobileFilterUpdate,\n    categoryClick = _searchSlice$actions.categoryClick,\n    changeJustExist = _searchSlice$actions.changeJustExist;\nexport { orderByTypeAdded, pageSizeAdded, priceAdded, goodsCreatedDayAdded, changeUrl, goodsOptionsAdded, brandsChanged, pageChanged, mobileFilterUpdate, categoryClick, changeJustExist };\nexport var orderByTypeAddedAction = function orderByTypeAddedAction(orderType) {\n  return function (dispatch, getState) {\n    dispatch(orderByTypeAdded(orderType));\n    dispatch(fetchSearch(selectFilters(getState())));\n  };\n};\nexport var pageSizeAddedAction = function pageSizeAddedAction(pageSize) {\n  return function (dispatch, getState) {\n    dispatch(pageSizeAdded(pageSize));\n    dispatch(fetchSearch(selectFilters(getState())));\n  };\n};\nexport var priceAddedAction = function priceAddedAction(from, to) {\n  return function (dispatch, getState) {\n    dispatch(priceAdded({\n      fromPrice: from,\n      toPrice: to\n    }));\n    dispatch(fetchSearch(selectFilters(getState())));\n  };\n};\nexport var goodsCreatedDayAddedAction = function goodsCreatedDayAddedAction(goodsCreatedDay) {\n  return function (dispatch, getState) {\n    if (!goodsCreatedDay) goodsCreatedDay = initialState.filters.goodsCreatedDay;\n    dispatch(goodsCreatedDayAdded(parseInt(goodsCreatedDay)));\n    dispatch(fetchSearch(selectFilters(getState())));\n  };\n};\nexport var goodsOptionsAddedAction = function goodsOptionsAddedAction(options) {\n  return function (dispatch, getState) {\n    dispatch(goodsOptionsAdded(options));\n    dispatch(fetchSearch(selectFilters(getState())));\n  };\n};\nexport var brandsChangedAction = function brandsChangedAction(brand, checked) {\n  return function (dispatch, getState) {\n    dispatch(brandsChanged({\n      brand: brand,\n      checked: checked\n    }));\n    dispatch(fetchSearch(selectFilters(getState())));\n  };\n};\nexport var brandsRemovedAction = function brandsRemovedAction(id) {\n  return function (dispatch, getState) {\n    var curr_state = getState();\n    var newBrands = selectFilters(curr_state).brandId.filter(function (brandId) {\n      return brandId !== id;\n    });\n    dispatch(brandAdded(newBrands));\n    dispatch(fetchSearch(selectFilters(getState())));\n  };\n};\nexport var pageChangedAction = function pageChangedAction(pageNumber) {\n  return function (dispatch, getState) {\n    dispatch(pageChanged(pageNumber));\n    dispatch(fetchSearch(selectFilters(getState())));\n  };\n};\nexport var mobileFilterUpdateAction = function mobileFilterUpdateAction(newFilters) {\n  return function (dispatch, getState) {\n    dispatch(mobileFilterUpdate(newFilters));\n    dispatch(fetchSearch(selectFilters(getState())));\n  };\n};\nexport var categoryClickAction = function categoryClickAction(catId) {\n  return function (dispatch, getState) {\n    dispatch(categoryClick(catId)); // dispatch(fetchSearch(selectFilters(getState())));\n  };\n};\nexport var justExistClickAction = function justExistClickAction(exist) {\n  return function (dispatch, getState) {\n    dispatch(changeJustExist(exist));\n    dispatch(fetchSearch(selectFilters(getState())));\n  };\n};\nexport default searchSlice.reducer;","map":null,"metadata":{},"sourceType":"module"}